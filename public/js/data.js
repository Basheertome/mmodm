var life = 30; // in seconds

var beats = [
{
	"name": "downbeat",
	"sequence": "o---o---o---o---"
},{
	"name": "hihat",
	"sequence": "-nnn--n----n---"
},{
	"name": "snare",
	"sequence": "v--v--v--v--v-v-"
},{
	"name": "bongo",
	"sequence": "j--i--i-j--i--i-"
},{
	"name": "hiphat",
	"sequence": "m-m-n--m-m-mn-n-"
}
]

var tracks = [
{
	"id": 0,
	"name": "a",
	"filename": "strings.mp3"
},
{
	"id": 1,
	"name": "b",
	"filename": "snare3.mp3"
},
{
	"id": 2,
	"name": "c",
	"filename": "timbales.mp3"
},
{
	"id": 3,
	"name": "d",
	"filename": "clap.mp3"
},
{
	"id": 4,
	"name": "e",
	"filename": "bell.mp3"
},
{
	"id": 5,
	"name": "f",
	"filename": "bongo-hi.mp3"
},
{
	"id": 6,
	"name": "g",
	"filename": "bongo-low.mp3"
},
{
	"id": 7,
	"name": "h",
	"filename": "triangle-mute.mp3"
},
{
	"id": 8,
	"name": "i",
	"filename": "conga-hi.mp3"
},
{
	"id": 9,
	"name": "j",
	"filename": "conga-low.mp3"
},
{
	"id": 10,
	"name": "k",
	"filename": "cowbell.mp3"
},
{
	"id": 11,
	"name": "l",
	"filename": "chirpy.mp3"
},
{
	"id": 12,
	"name": "m",
	"filename": "hihat-closed.mp3"
},
{
	"id": 13,
	"name": "n",
	"filename": "hihat-open.mp3"
},
{
	"id": 14,
	"name": "o",
	"filename": "kick.mp3"
},
{
	"id": 15,
	"name": "p",
	"filename": "kick2.mp3"
},
{
	"id": 16,
	"name": "q",
	"filename": "tom.mp3"
},
{
	"id": 17,
	"name": "r",
	"filename": "rimshot.mp3"
},
{
	"id": 18,
	"name": "s",
	"filename": "e-perc.mp3"
},
{
	"id": 19,
	"name": "t",
	"filename": "shaker.mp3"
},
{
	"id": 20,
	"name": "u",
	"filename": "snare.mp3"
},
{
	"id": 21,
	"name": "v",
	"filename": "snare2.mp3"
},
{
	"id": 22,
	"name": "w",
	"filename": "tambourin.mp3"
},
{
	"id": 23,
	"name": "x",
	"filename": "wood-hi.mp3"
},
{
	"id": 24,
	"name": "y",
	"filename": "wood-low.mp3"
},
{
	"id": 25,
	"name": "z",
	"filename": "e-perc2.mp3"
}
]

var intro = [[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,1,1,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,1,1,1,1,0.125,0.125,0.125,0.125,1,1,1,1,1,1,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,1,1,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125],[0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125,0.125]];

var smile = [[12,2],[13,2],[14,2],[15,2],[10,3],[11,3],[16,3],[17,3],[9,4],[18,4],[8,5],[11,5],[12,5],[15,5],[16,5],[19,5],[7,6],[11,6],[12,6],[15,6],[16,6],[20,6],[7,7],[20,7],[7,8],[20,8],[7,9],[20,9],[7,10],[9,10],[18,10],[20,10],[7,11],[10,11],[17,11],[20,11],[8,12],[11,12],[12,12],[13,12],[14,12],[15,12],[16,12],[19,12],[9,13],[18,13],[10,14],[11,14],[16,14],[17,14],[12,15],[13,15],[14,15],[15,15],
]

var letters = ["a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","-"];

var lock = [0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,];
var saveState = [];
var undoSave = [];
var saveUrl = "http://mmodm.co/savedurl";

var inputting = 0;

// converts binary string to a hexadecimal string
// returns an object with key 'valid' to a boolean value, indicating
// if the string is a valid binary string.
// If 'valid' is true, the converted hex string can be obtained by
// the 'result' key of the returned object
function binaryToHex(s) {
	var i, k, part, accum, ret = '';
	for (i = s.length-1; i >= 3; i -= 4) {
		// extract out in substrings of 4 and convert to hex
		part = s.substr(i+1-4, 4);
		accum = 0;
		for (k = 0; k < 4; k += 1) {
			if (part[k] !== '0' && part[k] !== '1') {
				// invalid character
				return { valid: false };
			}
			// compute the length 4 substring
			accum = accum * 2 + parseInt(part[k], 10);
		}
		if (accum >= 10) {
			// 'A' to 'F'
			ret = String.fromCharCode(accum - 10 + 'A'.charCodeAt(0)) + ret;
		} else {
			// '0' to '9'
			ret = String(accum) + ret;
		}
	}
	// remaining characters, i = 0, 1, or 2
	if (i >= 0) {
		accum = 0;
		// convert from front
		for (k = 0; k <= i; k += 1) {
			if (s[k] !== '0' && s[k] !== '1') {
				return { valid: false };
			}
			accum = accum * 2 + parseInt(s[k], 10);
		}
		// 3 bits, value cannot exceed 2^3 - 1 = 7, just convert
		ret = String(accum) + ret;
	}
	return { valid: true, result: ret };
}

// converts hexadecimal string to a binary string
// returns an object with key 'valid' to a boolean value, indicating
// if the string is a valid hexadecimal string.
// If 'valid' is true, the converted binary string can be obtained by
// the 'result' key of the returned object
function hexToBinary(s) {
	var i, k, part, ret = '';
	// lookup table for easier conversion. '0' characters are padded for '1' to '7'
	var lookupTable = {
		'0': '0000', '1': '0001', '2': '0010', '3': '0011', '4': '0100',
		'5': '0101', '6': '0110', '7': '0111', '8': '1000', '9': '1001',
		'a': '1010', 'b': '1011', 'c': '1100', 'd': '1101',
		'e': '1110', 'f': '1111',
		'A': '1010', 'B': '1011', 'C': '1100', 'D': '1101',
		'E': '1110', 'F': '1111'
	};
	for (i = 0; i < s.length; i += 1) {
		if (lookupTable.hasOwnProperty(s[i])) {
			ret += lookupTable[s[i]];
		} else {
			return { valid: false };
		}
	}
	return { valid: true, result: ret };
}
